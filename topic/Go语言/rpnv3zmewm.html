<!doctype html>
<html>
    <head>
        <!-- META Tags -->
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Go Modules 详解 | 风中的木偶</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- SEO -->
        <meta name="author" content="风中的木偶">
        <meta name="description" content="">
        <meta name="keywords" content="木偶笔记,个人技术博客,IT技术笔记,博客,个人网站,风中的木偶,木偶">
        <meta name="twitter:card" value="summary">
                                                                <meta property="og:title" content="风中的木偶个人博客" />
                                                                <meta property="og:type" content="article" />
                                                                <meta property="og:url" content="https://wangmaolin.net" />
                                                                                            
        <!-- CSS -->
        <link rel="stylesheet" href="../../vendor/binarytorch/larecipe/assets/css/app.css">

        
        <!-- FontAwesome -->
        <link rel="stylesheet" href="../../vendor/binarytorch/larecipe/assets/css/font-awesome.css">
                    <link rel="stylesheet" href="../../vendor/binarytorch/larecipe/assets/css/font-awesome-v4-shims.css">
        
        <!-- Dynamic Colors -->
        <style>
    :root {
        --primary: #787AF6;
        --secondary: #2b9cf2;
    }

    :not(pre)>code[class*=language-], pre[class*=language-] {
        border-top: 3px solid #787AF6;
    }
    
    .bg-gradient-primary {
        background: linear-gradient(87deg, #787AF6 0, #2b9cf2 100%) !important;
    }

    [v-cloak] > * { 
        display: none; 
    }
    
    [v-cloak]::before { 
        content: " ";
        position: absolute;
        width: 100%;
        height: 100%;
        background-color: #F2F6FA;
    }
</style>
        <!-- CSRF Token -->
        <meta name="csrf-token" content="476dd8VPqlno3tKrJ2sgvTLvrXXd14RRolMMi7yY">

        
    </head>
    <body>
        <div id="app" v-cloak>
            <div class="fixed pin-t pin-x z-40">
    <div class="bg-gradient-primary text-white h-1"></div>

    <nav class="flex items-center justify-between text-black bg-navbar shadow-xs h-16">
        <div class="flex items-center flex-no-shrink">
            <a href="../../index.html" class="flex items-center flex-no-shrink text-black mx-4">
                
                <p class="inline-block font-semibold mx-1 text-grey-dark">
                    风中的木偶
                </p>
            </a>

            <div class="switch">
                <input type="checkbox" name="1" id="1" v-model="sidebar" class="switch-checkbox"/>
                <label class="switch-label" for="1"></label>
            </div>
        </div>

        <div class="hidden lg:flex items-center justify-end pr-4">
            <div class="relative">
                <form action="https://wangmaolin.net/search" onsubmit="return validateForm()" class="form-search">
                    <input id="search-input" name="q" type="text" placeholder="Search" class="bg-gray-100 appearance-none border-2 border-gray-200 rounded py-2 px-4
         text-gray-800 leading-tight focus:outline-none focus:bg-white focus:border-gray-500">
                </form>
            </div>
        </div>

        <div class="block mx-4 flex items-center">
                        
            
            
            
            

            
            <larecipe-dropdown>
                <larecipe-button type="primary" class="flex">
                    Go语言 <i class="mx-1 fa fa-angle-down"></i>
                </larecipe-button>

                <template slot="list">
                    <ul class="list-reset" style="height: 800px;width: 200px">
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../AI/overview.html">AI</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../APP/overview.html">APP</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../CSS/overview.html">CSS</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Docker/overview.html">Docker</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../ELK/overview.html">ELK</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Git/overview.html">Git</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="overview.html">Go语言</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Laravel/overview.html">Laravel</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Linux/overview.html">Linux</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Linux&#32;服务器配置/overview.html">Linux 服务器配置</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Mac/overview.html">Mac</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../MongoDB/overview.html">MongoDB</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Mqtt/overview.html">Mqtt</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../MySQL/overview.html">MySQL</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Nginx/overview.html">Nginx</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../PHP/overview.html">PHP</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Protobuf/overview.html">Protobuf</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Python/overview.html">Python</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../SEO/overview.html">SEO</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Vue&#32;教程/overview.html">Vue 教程</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Windows/overview.html">Windows</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../webman/overview.html">webman</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../一无所有到财富自由/overview.html">一无所有到财富自由</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../云服务/overview.html">云服务</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../产品/overview.html">产品</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../元宇宙/overview.html">元宇宙</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../前端/overview.html">前端</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../合伙的本质/overview.html">合伙的本质</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../商业/overview.html">商业</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../大数据/overview.html">大数据</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../天机38局/overview.html">天机38局</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../开源项目/overview.html">开源项目</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../微信/overview.html">微信</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../控糖革命/overview.html">控糖革命</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../搜索/overview.html">搜索</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../支付/overview.html">支付</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../智慧人生/overview.html">智慧人生</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../架构/overview.html">架构</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../游戏开发/overview.html">游戏开发</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../算法/overview.html">算法</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../缓存/overview.html">缓存</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../网络/overview.html">网络</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../自媒体/overview.html">自媒体</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../菜谱/overview.html">菜谱</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../设计模式/overview.html">设计模式</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../资源/overview.html">资源</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../软件工具/overview.html">软件工具</a>
                            </li>
                                            </ul>
                </template>
            </larecipe-dropdown>
            

                    </div>
    </nav>
</div>

            
            <div>
	<div class="sidebar" :class="[{'is-hidden': ! sidebar}]">
    <ul>
<li>
<h2>Go教程</h2>
<ul>
<li id="blog274"><a href="z64y9kdv5l.html#blog274">Go 语言环境安装</a>
<li id="blog275"><a href="mx5e633e0r.html#blog275">Go 国内加速镜像 &amp; go get 命令国内加速</a>
<li id="blog276"><a href="rpnv3zmewm.html#blog276">Go Modules 详解</a>
<li id="blog277"><a href="n2oeg18e73.html#blog277">Go Module 之 go.mod 文件解析</a>
<li id="blog377"><a href="n2oegxwy73.html#blog377">Go 语言结构体介绍</a>
</ul>
</li>
<li>
<h2>Go语言</h2>
<ul>
<li id="blog319"><a href="2dne2p2y5q.html#blog319">GoLand 导入包时标红解决方法</a>
<li id="blog365"><a href="1j6y09zy2k.html#blog365">为什么 Go 语言是后端开发的未来</a>
<li id="blog374"><a href="z64y942e5l.html#blog374">Go 语言基础</a>
</ul>
</li>
</ul>
</div>

<style>
    #cnzz_stat_icon_1280630928
    {
        display: none;
    }
</style>

<script src="../../vendor/binarytorch/larecipe/assets/js/jquery.min.js"></script>
<script src="../../modules/blog/js/detail.js"></script>

<script type="text/javascript">
    $(function () {
        var cid = 'rpnv3zmewm.html';
        if (!checkView(cid)) {
            $.get('https://wangmaolin.net/api/blog/addView/article/rpnv3zmewm.html', function (data, status) {
                addView('rpnv3zmewm.html')
            });
        }
    });
</script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?7c12b9716af39eb368cff4a19aa89393";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7125202304422722"
     crossorigin="anonymous"></script>
	
	<div class="documentation is-dark" :class="{'expanded': ! sidebar}">
		<h1>Go Modules 详解</h1><ul>
<li><a href="rpnv3zmewm.html#16fd14889d15ae485d13033523c1c2c1">Modules 官方定义</a></li>
<li><a href="rpnv3zmewm.html#328ccc353ddfbad8d36fdf2ffe7e6440">使用modules</a></li>
<li><a href="rpnv3zmewm.html#2134fd4ba3db770790efe7d5fd583533">Go Modules 命令：</a></li>
<li><a href="rpnv3zmewm.html#10c237fae76e0fb73b38fc72b9befd5a">各命令使用场景：</a>
<ul>
<li><a href="rpnv3zmewm.html#425a66bc555f1a6a10ccf223a913fa7a">1、go mod init</a></li>
<li><a href="rpnv3zmewm.html#723632676457223ac880fad0a386c23a">2、下载模块</a></li>
<li><a href="rpnv3zmewm.html#a3dcdcd1b1c507f2f6c3fe38e22d4e9e">3、模块缓存</a></li>
<li><a href="rpnv3zmewm.html#60558ecad28751cbce2b0b589be658c8">4、Mod tidy</a></li>
<li><a href="rpnv3zmewm.html#360afc04aec903966a3c228fc4e07283">5、go mod download</a></li>
<li><a href="rpnv3zmewm.html#557c129ff84bade189070e399866a023">6、go mod why</a></li>
<li><a href="rpnv3zmewm.html#4ca8e1d8fd8fba9ce08e0f5d3df2d2af">7、go mod edit</a></li>
<li><a href="rpnv3zmewm.html#240980c6bb8adba352e3dcccc2020378">8、go mod vendor</a></li>
<li><a href="rpnv3zmewm.html#2947fbd64a7ee84d49bad8723e7bdda8">9、go mod verify</a></li>
<li><a href="rpnv3zmewm.html#1aee01aa5df01241c37451b9aa94d252">10、go mod graph</a></li>
</ul></li>
<li><a href="rpnv3zmewm.html#138a676635c31bde1e2c8b2c62432936">注意</a></li>
</ul><p>最早的时候，Go语言所依赖的所有的第三方库都放在 GOPATH 这个目录下面，这就导致了同一个库只能保存一个版本的代码。如果不同的项目依赖同一个第三方的库的不同版本，应该怎么解决？</p>
<p>go module 是Go语言从 1.11 版本之后官方推出的依赖管理工具，并且从 Go1.13 版本开始，go module 成为了Go语言默认的依赖管理工具。</p>
<h2 id="16fd14889d15ae485d13033523c1c2c1">Modules 官方定义</h2>
<p>Modules 是相关 Go 包的集合，是源代码交换和版本控制的单元。Go语言命令直接支持使用 Modules，包括记录和解析对其他模块的依赖性，Modules 替换旧的基于 GOPATH 的方法，来指定使用哪些源文件。</p>
<h2 id="328ccc353ddfbad8d36fdf2ffe7e6440">使用modules</h2>
<p>1) 首先需要把 golang 升级到 1.11 版本以上。</p>
<p>2) 设置 GO111MODULE。</p>
<p>golang提供了一个环境变量“GO111MODULE”来标识是否开启 go module 包管理模式</p>
<p><code>GO111MODULE=off</code> 禁用 go module，编译时会从 GOPATH 和 vendor 文件夹中查找包；</p>
<p><code>GO111MODULE=on</code>  (默认值)启用 go module，编译时会忽略 GOPATH 和 vendor 文件夹，只根据 go.mod下载依赖；</p>
<p><code>GO111MODULE=auto</code> 当项目在 GOPATH/src 目录之外，并且项目根目录有 go.mod 文件时，开启 go module。</p>
<p>在go1.16版本发布后，GO111MODULE 由原来的默认值 auto 变为 on 了，以后在新版本中建议使用on。</p>
<pre><code class="language-bash">go env -w GO111MODULE=on</code></pre>
<p>在开启 GO111MODULE 之后就可以使用 go module 工具了，也就是说在以后的开发中就没有必要在 GOPATH 中创建项目了，并且还能够很好的管理项目依赖的第三方包信息。</p>
<h2 id="2134fd4ba3db770790efe7d5fd583533">Go Modules 命令：</h2>
<p>golang 提供了 go mod 命令来管理包。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>go mod init</td>
<td>初始化当前文件夹，创建 go.mod 文件</td>
</tr>
<tr>
<td>go mod why</td>
<td>解释为什么需要依赖</td>
</tr>
<tr>
<td>go mod edit</td>
<td>编辑 go.mod 文件</td>
</tr>
<tr>
<td>go mod vendor</td>
<td>将依赖复制到 vendor 目录下</td>
</tr>
<tr>
<td>go mod verify</td>
<td>校验依赖</td>
</tr>
<tr>
<td>go mod graph</td>
<td>打印模块依赖图</td>
</tr>
<tr>
<td>go mod tidy</td>
<td>增加缺少的包，删除无用的包</td>
</tr>
<tr>
<td>go mod download</td>
<td>下载依赖包到本地缓存（默认为 GOPATH/pkg/mod 目录）</td>
</tr>
</tbody>
</table>
<h2 id="10c237fae76e0fb73b38fc72b9befd5a">各命令使用场景：</h2>
<h3 id="425a66bc555f1a6a10ccf223a913fa7a">1、go mod init</h3>
<p>这个命令是创建新项目的时候使用的。</p>
<p>在 Go 的工作空间里创建了一个项目目录(myapi)，进入 myapi 运行命令：</p>
<pre><code class="language-bash">go mod init </code></pre>
<p>命令初始化项目。<code>ls -l</code> 可以看到为我们生成了一个 go.mod 文件。</p>
<p>（<code>cat go.mod</code>）使用 cat 命令来打印 go.mod 里的内容。</p>
<pre><code class="language-bash">module github.com/summerblue/myapi

go 1.17</code></pre>
<p>文件中有两行代码，第一行是设置 模块名称，最后一行是设置最低要求的 go 版本。</p>
<p>因为我们是在 go 工作目录下运行初始化命令的，所有它根据 Go 开发的惯例，自动地为我们加上了 module 项目名称。</p>
<h3 id="723632676457223ac880fad0a386c23a">2、下载模块</h3>
<p>回到项目目录，接下来开始写代码，假如我们需要 go gin 来写 myapi 项目，使用 code . 打开 VSCode 编辑器，打开 go.mod 文件，可以看到目前只有两行代码。</p>
<p>因为要用到 gin 我们先使用 go get 下载依赖模块，右上角打开 vscode 内置命令行：</p>
<p>首先我们来看下 gin 模块都有哪些版本：</p>
<pre><code class="language-bash">$go list -m -versions -json github.com/gin-gonic/gin

{
    "Path": "github.com/gin-gonic/gin",
    "Version": "v1.7.4",
    "Versions": [
        "v1.1.1",
        "v1.1.2",
        "v1.1.3",
        "v1.1.4",
        "v1.3.0",
        "v1.4.0",
        "v1.5.0",
        "v1.6.0",
        "v1.6.1",
        "v1.6.2",
        "v1.6.3",
        "v1.7.0",
        "v1.7.1",
        "v1.7.2",
        "v1.7.3",
        "v1.7.4"
    ],
    "Time": "2021-08-03T02:40:44Z",
    "Dir": "/Users/summer/Code/go/pkg/mod/github.com/gin-gonic/gin@v1.7.4",
    "GoMod": "/Users/summer/Code/go/pkg/mod/cache/download/github.com/gin-gonic/gin/@v/v1.7.4.mod",
    "GoVersion": "1.13"
}</code></pre>
<p>如果要下载最新版本 gin 的话，可以使用 go get 命令：</p>
<pre><code class="language-bash">go get github.com/gin-gonic/gin</code></pre>
<p>这会下载最新版本，可以看到我们下载了 v1.7.4，打开 go.mod 文件，也可以看到变更。</p>
<p>如果想下载之前的版本，可以使用以下命令：</p>
<pre><code class="language-bash">go get github.com/gin-gonic/gin@v1.7.0</code></pre>
<p>可以看到 go.mod 文件的变更。</p>
<p>go get 命令会判断当前项目会通过 go.mod 文件来是否使用了 go module ，如果是的话会更新 go.mod 文件，写入依赖。</p>
<p>Go.sum 文件是下载依赖模块时候，请求 go sum 服务器获得的模块的哈希值，这是 go mudules 的一个安全机制，以保证下载模块不会被不怀好意的中间人窜改代码。</p>
<h3 id="a3dcdcd1b1c507f2f6c3fe38e22d4e9e">3、模块缓存</h3>
<p>下载的模块会被放置于 GOPATH 中，具体位置我们打开：</p>
<pre><code class="language-bash">cd $GOPATH/pkg/mod/github.com/gin-gonic</code></pre>
<p>目录的名称是项目加版本号，这个版本号跟我们的 go.mod 文件对应。</p>
<p>进入 gin 项目中，可以看到 go gin 的源码。</p>
<p>Go get 命令第一次下载模块时，会进行缓存，后面再次 go get 这个模块，刚好版本也是一样的话，就会直接从本地缓存读取。</p>
<p>我们先来看 go mod 存放的目录：</p>
<pre><code class="language-bash">cd $GOPATH/pkg</code></pre>
<p>这里面的 mod 就是第三方模块的缓存目录。</p>
<p>接下来我们来清空缓存，使用</p>
<pre><code class="language-bash">go clean --modcache</code></pre>
<p>再次 ls -l ，可以看到 mod 目录以及被清空。</p>
<p>再次进入项目目录，使用 go get 命令：</p>
<pre><code class="language-bash">go get github.com/gin-gonic/gin</code></pre>
<p>可以看到输出：</p>
<pre><code class="language-bash">go: downloading github.com/gin-gonic/gin v1.7.4
go: downloading github.com/gin-contrib/sse v0.1.0
go: downloading github.com/mattn/go-isatty v0.0.12
go: downloading github.com/json-iterator/go v1.1.9
go: downloading github.com/golang/protobuf v1.3.3
go: downloading github.com/ugorji/go/codec v1.1.7
go: downloading gopkg.in/yaml.v2 v2.2.8
go: downloading github.com/go-playground/validator/v10 v10.4.1
go: downloading golang.org/x/sys v0.0.0-20200116001909-b77594299b42
go: downloading github.com/modern-go/concurrent v0.0.0-20180228061459-e0a39a4cb421
go: downloading github.com/modern-go/reflect2 v0.0.0-20180701023420-4b7aa43c6742
go: downloading golang.org/x/crypto v0.0.0-20200622213623-75b288015ac9
go: downloading github.com/go-playground/universal-translator v0.17.0
go: downloading github.com/leodido/go-urn v1.2.0
go: downloading github.com/go-playground/locales v0.13.0</code></pre>
<p>进入 go.mod 文件，把 require 部分的代码删除并保存，再次下载 gin 模块：</p>
<pre><code class="language-bash">go get github.com/gin-gonic/gin</code></pre>
<p>输出：</p>
<pre><code class="language-bash">go: downloading github.com/ugorji/go v1.1.7
go get: added github.com/gin-contrib/sse v0.1.0
go get: added github.com/gin-gonic/gin v1.7.4
go get: added github.com/go-playground/locales v0.13.0
go get: added github.com/go-playground/universal-translator v0.17.0
go get: added github.com/go-playground/validator/v10 v10.4.1
go get: added github.com/golang/protobuf v1.3.3
go get: added github.com/json-iterator/go v1.1.9
go get: added github.com/leodido/go-urn v1.2.0
go get: added github.com/mattn/go-isatty v0.0.12
go get: added github.com/modern-go/concurrent v0.0.0-20180228061459-e0a39a4cb421
go get: added github.com/modern-go/reflect2 v0.0.0-20180701023420-4b7aa43c6742
go get: added github.com/ugorji/go/codec v1.1.7
go get: added golang.org/x/crypto v0.0.0-20200622213623-75b288015ac9
go get: added golang.org/x/sys v0.0.0-20200116001909-b77594299b42
go get: added gopkg.in/yaml.v2 v2.2.8</code></pre>
<p>可以看到变成 go added  而不是 go downloading ，意味着从缓存读取。</p>
<p>重新进入缓存目录也可以看到下载下来的源码。</p>
<pre><code class="language-bash">cd $GOPATH/pkg/mod/github.com/gin-gonic</code></pre>
<h3 id="60558ecad28751cbce2b0b589be658c8">4、Mod tidy</h3>
<p>再次打开 go.mod 文件，可以看到文件比较混乱，我们看不出来哪些模块是项目依赖，哪些是第二层的依赖，也就是依赖的依赖。</p>
<p>此时可以使用：</p>
<pre><code class="language-bash">go mod tidy</code></pre>
<p>可以看到 require 被分被分为两个区块，第一个区块就是我们的项目依赖，第二个是第二层依赖。</p>
<p>假如我们引入另一个模块（打开网站 <a href="https://github.com/uber-go/zap">https://github.com/uber-go/zap</a> ，根据 reademe）：</p>
<pre><code class="language-bash">go get -u go.uber.org/zap</code></pre>
<p>Go get 的 -u 参数，u 是 update 的简写，会更新现有模块到最新版（1.17 默认的 get 是会下载最新的功能）。</p>
<p>我们下载了，但是没有使用，假如我们项目中不需要用到某些模块了，不需要手动在 go.mod 中去删除他们，只需要：</p>
<pre><code class="language-bash">go mod tidy</code></pre>
<p>即可看到 zap 被清除。</p>
<h3 id="360afc04aec903966a3c228fc4e07283">5、go mod download</h3>
<p>下面来看 download 命令，此命令会根据 go.mod 文件下载模块，并放置于缓存里。</p>
<p>首先我们清空模块缓存：</p>
<pre><code class="language-bash">go clean --modcache</code></pre>
<p>运行命令：</p>
<pre><code class="language-bash">go mod download -x</code></pre>
<p>可以看到下载信息。</p>
<p>注意这里我们使用了 -x 参数，默认不使用参数是不会打印出来内容，除非遇到错误。</p>
<p>我们来看下还有哪些参数：</p>
<pre><code class="language-bash">go help mod download</code></pre>
<p>这里比较实用的有一个 -json 参数，我们来试一试：</p>
<pre><code class="language-bash">go mod download -json</code></pre>
<p>-json 可以用来查看到模块下载的 zip 存放位置，以及解压后的位置</p>
<h3 id="557c129ff84bade189070e399866a023">6、go mod why</h3>
<p>下一个命令是 Go mod why ，why 命令可以用来查看为何需要用到一个或做个模块。</p>
<p>例如打开我们的 go.mod 文件，可以的看最下面 yaml 模块我们使用到了 v2 和 v3 ，使用以下命令看下</p>
<pre><code class="language-bash">go mod why gopkg.in/yaml.v2</code></pre>
<p>这是依赖自上而下的结构，我们项目依赖于 gin ，gin 使用 binding 模块，而 binding 模块依赖于 yaml.v2 。</p>
<p>那我们再来看下</p>
<pre><code class="language-bash">go mod why gopkg.in/yaml.v3</code></pre>
<p>最后来看下帮助信息：</p>
<pre><code class="language-bash">go help mod why</code></pre>
<p>注意到这里面有个 vendor 参数，会跳过测试依赖，只查看业务逻辑中的依赖。</p>
<p>并且我们发现 why 命令可以接受多个参数，接下来</p>
<pre><code class="language-bash">go mod why gopkg.in/yaml.v2 gopkg.in/yaml.v3</code></pre>
<p>可以看到 v3 是  <code>stretchr/testif</code> 模块的 <code>assert</code> 模块里中依赖的，我们知道这是一个很知名测试框架。</p>
<p>添加 vonder 参数</p>
<pre><code class="language-bash">go mod why -vendor gopkg.in/yaml.v2 gopkg.in/yaml.v3</code></pre>
<p>可以看到在业务逻辑中我们不需要用到 yaml 的  v3 版本。</p>
<h3 id="4ca8e1d8fd8fba9ce08e0f5d3df2d2af">7、go mod edit</h3>
<p>下面来讲 Go mod edit，edit 命令是用来修改 go.mod 文件的。</p>
<p>先来查看帮助信息：</p>
<pre><code class="language-bash">go help mod edit</code></pre>
<p>基本上 go.mod 里的指令都可以被修改，我们来看下 go.mod 里面的内容，这些前面的第一个单词我们称之为 go 指令。</p>
<p>Go 指令是限制 go 的最低版本要求，假如我们要修改 go 版本使用：</p>
<pre><code class="language-bash">go mod edit -go=1.16</code></pre>
<p>即可改为 1.16 ，修改为 1.17 也可以使用：</p>
<pre><code class="language-bash">go mod edit -go=1.17</code></pre>
<p>Go mod edit 允许我们通过代码或者脚本对 go.mod 文件进行编辑。例如说 go get 的时候，会自动写入到 require 里，和 go mod tidy 命令用来整理 go.mod 文件。</p>
<p>这个命令是 go 命令，例如 go get 或者 go mod download 内部使用的命令，一般不需要用到。</p>
<h3 id="240980c6bb8adba352e3dcccc2020378">8、go mod vendor</h3>
<p>接下来讲解 go mod vendor 命令。</p>
<p>这个命令会在目录下生成 vendor 目录，执行命令：</p>
<pre><code class="language-bash">go mod vendor</code></pre>
<p>当 vendor 目录存在时，go build 和 go run 命令都会优先使用这个目录下的代码进行编译。</p>
<p>这个可能在调试代码的时候比较好用，方便修改下依赖库的源码代码。</p>
<p>但是需要注意的是在下一次 go get 后基本上这些代码就得作废。</p>
<p>例如我们新增加一个依赖模块：</p>
<pre><code class="language-bash">go get go.uber.org/zap</code></pre>
<p>当再次执行的时候，go build 的时候：</p>
<pre><code class="language-bash">go build</code></pre>
<p>会出现报错。go 命令运行时会比对 go.mod 和 vendor/modules.txt ，发现我们 vendor 里的代码已经过期了。</p>
<p>这个使用只能重新运行：</p>
<pre><code class="language-bash">go mod vendor</code></pre>
<p>而这个命令，会直接删除 vendor 目录，再重建 vendor。</p>
<p>那么这个命令的作用是什么呢？</p>
<p>根据 Russ Cox 在 <a href="https://research.swtch.com/vgo-module*#end_of_vendoring">https://research.swtch.com/vgo-module*#end_of_vendoring</a> 解释，这只是一个过渡方案。</p>
<p>Go Modules 这套官方的模块管理机制，是在 2018 年发布的 go 1.11 版本才出现的，在这之前，有很多第三方的包管理工具，如 dep ，godep，glide，这些工具统一都使用 vendor 目录。</p>
<p>之前的第三方工具，都是直接从代码仓库例如说 GitHub 上直接下载模块代码，但这些仓库可以被删掉，这会导致原本依赖这个项目的代码无法工作，有了 vendor 目录，代码存放在本地，就可以保证项目永远是可运行的。</p>
<p>但是在 go module 现有的机制下，我们有 goproxy ，所有的代码都是存放在 proxy 服务器上，proxy 服务器上面做了缓存，所以无需再担心代码仓库被删除的因素。</p>
<p>这里我们来简单讲下 go module 的机制，命令行：</p>
<pre><code class="language-bash">go env</code></pre>
<p>GOPROXY 是配置 zip 文件的下载服务器，而 GOSUMDB 是指定 zip 文件哈希值的服务器。</p>
<p>Go mod verify 命令就是用来校验从 GOPROXY 服务器上下载的 zip 文件与 GOSUMDB 服务器下载下来的哈希值，是否匹配。</p>
<h3 id="2947fbd64a7ee84d49bad8723e7bdda8">9、go mod verify</h3>
<p>下面讲解下  verify.</p>
<p>运行下这个命令：</p>
<pre><code class="language-bash">go mod verify</code></pre>
<p>提示我们所有模块验证通过。</p>
<p>接下来我们尝试修改哈希值，使其不匹配。</p>
<p>首先看下文件存放在哪里：</p>
<pre><code class="language-bash">go mod download -json | grep gin</code></pre>
<p>进入下载目录：</p>
<pre><code class="language-bash">cd /Users/summer/Code/go/pkg/mod/cache/download/github.com/gin-gonic/gin/@v</code></pre>
<p>修改 zip 文件的哈希文件：</p>
<pre><code class="language-bash">v1.7.4.ziphash</code></pre>
<p>这个时候再次执行命令，即可看到提示有修改：</p>
<pre><code class="language-bash">go mod verify</code></pre>
<p>这个命令是 go 命令，例如 go get 或者 go mod download 内部使用的命令，一般不需要用到。</p>
<p>（切到 go env 界面）由此可见，goproxy 我们可以随意更改，而 gosumdb 服务器的值修改需要比较慎重。</p>
<p>因为 gosumdb 可以有效防止下载的 zip 模块被篡改，确保了模块下载的安全性。</p>
<h3 id="1aee01aa5df01241c37451b9aa94d252">10、go mod graph</h3>
<p>Go mod 的最后一个命令：</p>
<pre><code class="language-bash">go mod graph</code></pre>
<p>打印模块依赖图。</p>
<p>这个命令也是 go 工具链的内部使用。一般不需要用到。</p>
<h2 id="138a676635c31bde1e2c8b2c62432936">注意</h2>
<p>更换或升级了Golang后，需要删除<code>go.mod</code>、<code>go.sum</code>、<code>vendor</code>文件，然后重建，不然一直卡在那里</p>
			</div>
</div>

            <larecipe-back-to-top></larecipe-back-to-top>
        </div>


        <script>
            window.config = [];
        </script>

        <script type="text/javascript">
            if(localStorage.getItem('larecipeSidebar') == null) {
                localStorage.setItem('larecipeSidebar', !! 1);
            }
        </script>

        <script src="../../vendor/binarytorch/larecipe/assets/js/app.js"></script>

        <script>
            window.LaRecipe = new CreateLarecipe(config)
        </script>

        <!-- Google Analytics -->
                <!-- /Google Analytics -->

        
        <script>
            LaRecipe.run()
        </script>
    </body>
</html>
