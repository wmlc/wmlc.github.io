<!doctype html>
<html>
    <head>
        <!-- META Tags -->
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>双因素认证（2FA）教程 | 风中的木偶</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- SEO -->
        <meta name="author" content="风中的木偶">
        <meta name="description" content="">
        <meta name="keywords" content="木偶笔记,个人技术博客,IT技术笔记,博客,个人网站,风中的木偶,木偶">
        <meta name="twitter:card" value="summary">
                                                                <meta property="og:title" content="风中的木偶个人博客" />
                                                                <meta property="og:type" content="article" />
                                                                <meta property="og:url" content="https://wangmaolin.net" />
                                                                                            
        <!-- CSS -->
        <link rel="stylesheet" href="../../vendor/binarytorch/larecipe/assets/css/app.css">

        
        <!-- FontAwesome -->
        <link rel="stylesheet" href="../../vendor/binarytorch/larecipe/assets/css/font-awesome.css">
                    <link rel="stylesheet" href="../../vendor/binarytorch/larecipe/assets/css/font-awesome-v4-shims.css">
        
        <!-- Dynamic Colors -->
        <style>
    :root {
        --primary: #787AF6;
        --secondary: #2b9cf2;
    }

    :not(pre)>code[class*=language-], pre[class*=language-] {
        border-top: 3px solid #787AF6;
    }
    
    .bg-gradient-primary {
        background: linear-gradient(87deg, #787AF6 0, #2b9cf2 100%) !important;
    }

    [v-cloak] > * { 
        display: none; 
    }
    
    [v-cloak]::before { 
        content: " ";
        position: absolute;
        width: 100%;
        height: 100%;
        background-color: #F2F6FA;
    }
</style>
        <!-- CSRF Token -->
        <meta name="csrf-token" content="frrBW4DvuFNY0e6AyDqU3Itj2DLGTTxPOBGKuWip">

        
    </head>
    <body>
        <div id="app" v-cloak>
            <div class="fixed pin-t pin-x z-40">
    <div class="bg-gradient-primary text-white h-1"></div>

    <nav class="flex items-center justify-between text-black bg-navbar shadow-xs h-16">
        <div class="flex items-center flex-no-shrink">
            <a href="../../index.html" class="flex items-center flex-no-shrink text-black mx-4">
                
                <p class="inline-block font-semibold mx-1 text-grey-dark">
                    风中的木偶
                </p>
            </a>

            <div class="switch">
                <input type="checkbox" name="1" id="1" v-model="sidebar" class="switch-checkbox"/>
                <label class="switch-label" for="1"></label>
            </div>
        </div>

        <div class="hidden lg:flex items-center justify-end pr-4">
            <div class="relative">
                <form action="https://wangmaolin.net/search" onsubmit="return validateForm()" class="form-search">
                    <input id="search-input" name="q" type="text" placeholder="Search" class="bg-gray-100 appearance-none border-2 border-gray-200 rounded py-2 px-4
         text-gray-800 leading-tight focus:outline-none focus:bg-white focus:border-gray-500">
                </form>
            </div>
        </div>

        <div class="block mx-4 flex items-center">
                        
            
            
            
            

            
            <larecipe-dropdown>
                <larecipe-button type="primary" class="flex">
                    架构 <i class="mx-1 fa fa-angle-down"></i>
                </larecipe-button>

                <template slot="list">
                    <ul class="list-reset" style="height: 800px;width: 200px">
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../AI/overview.html">AI</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../APP/overview.html">APP</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../CSS/overview.html">CSS</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Docker/overview.html">Docker</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../ELK/overview.html">ELK</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Git/overview.html">Git</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Go语言/overview.html">Go语言</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Laravel/overview.html">Laravel</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Linux/overview.html">Linux</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Linux&#32;服务器配置/overview.html">Linux 服务器配置</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Mac/overview.html">Mac</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../MongoDB/overview.html">MongoDB</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Mqtt/overview.html">Mqtt</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../MySQL/overview.html">MySQL</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Nginx/overview.html">Nginx</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../PHP/overview.html">PHP</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Protobuf/overview.html">Protobuf</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Python/overview.html">Python</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../SEO/overview.html">SEO</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Vue&#32;教程/overview.html">Vue 教程</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Windows/overview.html">Windows</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../一无所有到财富自由/overview.html">一无所有到财富自由</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../云服务/overview.html">云服务</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../产品/overview.html">产品</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../元宇宙/overview.html">元宇宙</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../前端/overview.html">前端</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../合伙的本质/overview.html">合伙的本质</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../商业/overview.html">商业</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../大数据/overview.html">大数据</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../天机38局/overview.html">天机38局</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../开源项目/overview.html">开源项目</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../微信/overview.html">微信</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../控糖革命/overview.html">控糖革命</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../搜索/overview.html">搜索</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../支付/overview.html">支付</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../智慧人生/overview.html">智慧人生</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="overview.html">架构</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../算法/overview.html">算法</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../缓存/overview.html">缓存</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../网络/overview.html">网络</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../自媒体/overview.html">自媒体</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../菜谱/overview.html">菜谱</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../设计模式/overview.html">设计模式</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../资源/overview.html">资源</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../软件工具/overview.html">软件工具</a>
                            </li>
                                            </ul>
                </template>
            </larecipe-dropdown>
            

                    </div>
    </nav>
</div>

            
            <div>
	<div class="sidebar" :class="[{'is-hidden': ! sidebar}]">
    <ul>
<li>
<h2>分布式</h2>
<ul>
<li id="blog76"><a href="jenydjoy7d.html#blog76">TCC 分布式事务的实现原理</a>
</ul>
</li>
<li>
<h2>地图</h2>
<ul>
<li id="blog216"><a href="od6vrzn93g.html#blog216">后台管理系统如何给具体地址添加经纬度坐标？</a>
</ul>
</li>
<li>
<h2>微服务</h2>
<ul>
<li id="blog269"><a href="qk2vmw9yp0.html#blog269">微服务是什么?</a>
</ul>
</li>
<li>
<h2>架构</h2>
<ul>
<li id="blog316"><a href="nq5vrnke7p.html#blog316">直播间状态变更通知所有用户方案</a>
<li id="blog324"><a href="8loynj1vz3.html#blog324">系统注销用户的逻辑</a>
<li id="blog363"><a href="j25v16ge1n.html#blog363">设计无密码登录指南</a>
<li id="blog383"><a href="3qk94gx9w1.html#blog383">系统负载介绍</a>
<li id="blog452"><a href="rpnv39dvwm.html#blog452">下云 - 什么情况下不能离开云计算</a>
<li id="blog487"><a href="ekpv1d2v8w.html#blog487">广告系统架构介绍</a>
<li id="blog570"><a href="j3oyjek9p5.html#blog570">地图红绿灯倒计时功能是如何实现的？</a>
<li id="blog676"><a href="enyd5oo97d.html#blog676">单点登录的实现</a>
<li id="blog677"><a href="5dve2ekv4x.html#blog677">如何防止订单重复支付</a>
<li id="blog694"><a href="3oyjdg8yp5.html#blog694">抢红包系统设计</a>
</ul>
</li>
<li>
<h2>安全</h2>
<ul>
<li id="blog317"><a href="02ky0m69z8.html#blog317">Cloudflare 推出 Turnstile — 一款用户友好且保护隐私的 CAPTCHA 替代方案</a>
<li id="blog379"><a href="wkl9nd8yz4.html#blog379">JWT 认证和授权：详细介绍</a>
<li id="blog380"><a href="gxpv5n5v86.html#blog380">浏览器同源政策及其规避方法</a>
<li id="blog381"><a href="n3xyqnlymq.html#blog381">跨域资源共享 CORS 详解</a>
<li id="blog382"><a href="4x3voeo9m1.html#blog382">XSS 跨站脚本攻击介绍</a>
<li id="blog444"><a href="4wevwrzyl2.html#blog444">双因素认证（2FA）教程</a>
<li id="blog477"><a href="15dved394x.html#blog477">开发安全的 API 所需要核对的清单</a>
<li id="blog667"><a href="m892gnoy01.html#blog667">target=&quot;_blank” 属性的安全漏洞</a>
<li id="blog678"><a href="4rvgnzkydj.html#blog678">CSRF跨站请求伪造攻击</a>
<li id="blog708"><a href="xpv52r1v86.html#blog708">文件上传安全注意事项</a>
<li id="blog709"><a href="3xyq4qjvmq.html#blog709">SQL 注入漏洞</a>
<li id="blog710"><a href="x3vo0qkvm1.html#blog710">服务器漏洞</a>
</ul>
</li>
<li>
<h2>性能</h2>
<ul>
<li id="blog338"><a href="xrwyl6zyz8.html#blog338">关于系统性能的认知</a>
<li id="blog436"><a href="x569x089ep.html#blog436">提高前端代码性能的最佳实践</a>
<li id="blog720"><a href="wevwmxn9l2.html#blog720">高并发相关技巧(待完善)</a>
</ul>
</li>
<li>
<h2>编程</h2>
<ul>
<li id="blog569"><a href="1ndvm4pv3j.html#blog569">提高代码可读性和效率的 11 个技巧</a>
</ul>
</li>
</ul>
</div>

<style>
    #cnzz_stat_icon_1280630928
    {
        display: none;
    }
</style>

<script src="../../vendor/binarytorch/larecipe/assets/js/jquery.min.js"></script>
<script src="../../modules/blog/js/detail.js"></script>

<script type="text/javascript">
    $(function () {
        var cid = '4wevwrzyl2.html';
        if (!checkView(cid)) {
            $.get('https://wangmaolin.net/api/blog/addView/article/4wevwrzyl2.html', function (data, status) {
                addView('4wevwrzyl2.html')
            });
        }
    });
</script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?7c12b9716af39eb368cff4a19aa89393";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7125202304422722"
     crossorigin="anonymous"></script>
	
	<div class="documentation is-dark" :class="{'expanded': ! sidebar}">
		<h1>双因素认证（2FA）教程</h1><ul>
<li><a href="4wevwrzyl2.html#05f597d52a60571c5bbdfb9c2905d033">一、双因素认证的概念</a></li>
<li><a href="4wevwrzyl2.html#c77a1484a083775871d44f9bdb7d0909">二、双因素认证方案</a></li>
<li><a href="4wevwrzyl2.html#65711f8101e4564ebe15cac2f4e730ee">三、TOTP 的概念</a></li>
<li><a href="4wevwrzyl2.html#0a41459d555343332bdc41e1d0e4f804">五、TOTP 的算法</a></li>
<li><a href="4wevwrzyl2.html#6f06116b7dfd746e910c8ecf95c4bb59">五、TOTP 的实现</a></li>
<li><a href="4wevwrzyl2.html#c57341ded1feb6f9d5b9029ba397e56d">六、总结</a></li>
<li><a href="4wevwrzyl2.html#7f4576f558ebec8c9b2719a8d1642533">七、参考链接</a>
<ul>
<li><a href="4wevwrzyl2.html#38f519304a768c940587c9a157280045">文档信息</a></li>
</ul></li>
</ul><p>所谓认证（authentication）就是确认用户的身份，是网站登录必不可少的步骤。</p>
<p>密码是最常见的认证方法，但是不安全，容易泄露和冒充。</p>
<p><img src="../../storage/images/2023/10/fGXBEmXbl3bt8CBYyvq2kq1fBQQqE5UD0GssSprm.png" alt="" /></p>
<p>越来越多的地方，要求启用双因素认证（Two-factor authentication，简称 2FA）。本文介绍它的概念和实现方法。</p>
<p><img src="../../storage/images/2023/10/FFZ4fBgC8xzlE40OaRTKYmTHcOXpkdmpcsEtAhCI.png" alt="" /></p>
<h2 id="05f597d52a60571c5bbdfb9c2905d033">一、双因素认证的概念</h2>
<p>一般来说，三种不同类型的证据，可以证明一个人的身份。</p>
<blockquote>
<ul>
<li><strong>秘密信息</strong>：只有该用户知道、其他人不知道的某种信息，比如密码。</li>
<li><strong>个人物品</strong>：该用户的私人物品，比如身份证、钥匙。</li>
<li><strong>生理特征</strong>：该用户的遗传特征，比如指纹、相貌、虹膜等等。</li>
</ul>
</blockquote>
<p>这些证据就称为三种&quot;因素&quot;（factor）。因素越多，证明力就越强，身份就越可靠。</p>
<p>双因素认证就是指，通过认证同时需要两个因素的证据。</p>
<p>银行卡就是最常见的双因素认证。用户必须同时提供银行卡和密码，才能取到现金。</p>
<h2 id="c77a1484a083775871d44f9bdb7d0909">二、双因素认证方案</h2>
<p>常用的双因素组合是密码 + 某种个人物品，比如网上银行的 U 盾。用户插上 U 盾，再输入密码，才能登录网上银行。</p>
<p><img src="../../storage/images/2023/10/FIYx7y6XPxaLMsI0ce2SNDyzVLJWV0iOcOkRWBUe.png" alt="" /></p>
<p>但是，用户不可能随时携带 U 盾，手机才是最好的替代品。密码 + 手机就成了最佳的双因素认证方案。</p>
<p><img src="../../storage/images/2023/10/3hEgYwoaBCAONbSNlmlNg2wpNminQ3znd7YZ0rSm.png" alt="" /></p>
<p>国内的很多网站要求，用户输入密码时，还要提供短消息发送的验证码，以证明用户确实拥有该手机。</p>
<p><img src="../../storage/images/2023/10/KHgpEtOPpEk39NZeJR6kcMG5LZv9mXFLjU3S8nvi.png" alt="" /></p>
<p>但是，短消息是不安全的，容易被拦截和伪造，SIM 卡也可以克隆。已经有<a href="http://media.people.com.cn/n/2014/0227/c40606-24477072.html">案例</a>，先伪造身份证，再申请一模一样的手机号码，把钱转走。</p>
<p>因此，安全的双因素认证不是密码 + 短消息，而是下面要介绍的 <a href="https://en.wikipedia.org/wiki/Time-based_One-time_Password_Algorithm">TOTP</a>。</p>
<h2 id="65711f8101e4564ebe15cac2f4e730ee">三、TOTP 的概念</h2>
<p>TOTP 的全称是&quot;基于时间的一次性密码&quot;（Time-based One-time Password）。它是公认的可靠解决方案，已经写入国际标准 <a href="https://tools.ietf.org/html/rfc6238">RFC6238</a>。</p>
<p><img src="../../storage/images/2023/10/AP5Vci8sh3rTE3egFbxJem43nNGcVT2Mu7IRISFv.png" alt="" /></p>
<p>它的步骤如下。</p>
<p>第一步，用户开启双因素认证后，服务器生成一个密钥。</p>
<p>第二步：服务器提示用户扫描二维码（或者使用其他方式），把密钥保存到用户的手机。也就是说，服务器和用户的手机，现在都有了同一把密钥。</p>
<p><img src="../../storage/images/2023/10/RLH6lT0RuFhEPqm340P1aXFZ8sTfCuWQ48vBHXbu.png" alt="" /></p>
<p>注意，密钥必须跟手机绑定。一旦用户更换手机，就必须生成全新的密钥。</p>
<p>第三步，用户登录时，手机客户端使用这个密钥和当前时间戳，生成一个哈希，有效期默认为30秒。用户在有效期内，把这个哈希提交给服务器。</p>
<p><img src="../../storage/images/2023/10/HNNjrh0PoxNn4JvaGevVFPTfRNtyOcc8f7w3Isi6.png" alt="" /></p>
<p>第四步，服务器也使用密钥和当前时间戳，生成一个哈希，跟用户提交的哈希比对。只要两者不一致，就拒绝登录。</p>
<h2 id="0a41459d555343332bdc41e1d0e4f804">五、TOTP 的算法</h2>
<p>仔细看上面的步骤，你可能会有一个问题：手机客户端和服务器，如何保证30秒期间都得到同一个哈希呢？</p>
<p>答案就是下面的公式。</p>
<blockquote>
<pre><code class="   language-php"># floor — 舍去法取整
TC = floor((unixtime(now) − unixtime(T0)) / TS)
</code></pre>
</blockquote>
<p>上面的公式中，TC 表示一个时间计数器，<code>unixtime(now)</code>是当前 Unix 时间戳，<code>unixtime(T0)</code>是约定的起始时间点的时间戳，默认是<code>0</code>，也就是1970年1月1日。TS 则是哈希有效期的时间长度，默认是30秒。因此，上面的公式就变成下面的形式。</p>
<blockquote>
<pre><code class="   language-php">
TC = floor(unixtime(now) / 30)
</code></pre>
</blockquote>
<p>所以，只要在 30 秒以内，TC 的值都是一样的。前提是服务器和手机的时间必须同步。</p>
<p>接下来，就可以算出哈希了。</p>
<blockquote>
<pre><code class="   language-php">
TOTP = HASH(SecretKey, TC)
</code></pre>
</blockquote>
<p>上面代码中，<code>HASH</code>就是约定的哈希函数，默认是 SHA-1。</p>
<p>TOTP 有硬件生成器和软件生成器之分，都是采用上面的算法。</p>
<p><img src="../../storage/images/2023/10/VXfm4BKYQPb7FNS5KLfq8aJ1noiKdYG07p1D2Stg.png" alt="" /></p>
<p>（说明：TOTP 硬件生成器）</p>
<p><img src="../../storage/images/2023/10/sh2nIizBozkcz4usYxQT2IuPgC8UJV5LAmxiTixt.png" alt="" /></p>
<p>（说明：Google Authenticator 是一个生成 TOTP 的手机 App）</p>
<h2 id="6f06116b7dfd746e910c8ecf95c4bb59">五、TOTP 的实现</h2>
<p>TOTP 很容易写，各个语言都有实现。下面我用 JavaScript 实现<a href="https://github.com/simontabor/2fa"><code>2fa</code></a>来演示一下真实代码。</p>
<p>首先，安装这个模块。</p>
<blockquote>
<pre><code class="   language-php">
$ npm install --save 2fa
</code></pre>
</blockquote>
<p>然后，生成一个32位字符的密钥。</p>
<blockquote>
<pre><code class="   language-php">
var tfa = require('2fa');

tfa.generateKey(32, function(err, key) {
  console.log(key);
});
// b5jjo0cz87d66mhwa9azplhxiao18zlx
</code></pre>
</blockquote>
<p>现在就可以生成哈希了。</p>
<blockquote>
<pre><code class="   language-php">
var tc = Math.floor(Date.now() / 1000 / 30);
var totp = tfa.generateCode(key, tc);
console.log(totp); // 683464
</code></pre>
</blockquote>
<h2 id="c57341ded1feb6f9d5b9029ba397e56d">六、总结</h2>
<p>双因素认证的优点在于，比单纯的密码登录安全得多。就算密码泄露，只要手机还在，账户就是安全的。各种密码破解方法，都对双因素认证无效。</p>
<p>缺点在于，登录多了一步，费时且麻烦，用户会感到不耐烦。而且，它也不意味着账户的绝对安全，入侵者依然可以通过盗取 cookie 或 token，劫持整个对话（session）。</p>
<p>双因素认证还有一个最大的问题，那就是帐户的恢复。</p>
<p><img src="../../storage/images/2023/10/vItbbJ0X1spuaUMPNxUnW7D2PeaEDFRkVFQYqmCY.png" alt="" /></p>
<p>一旦忘记密码或者遗失手机，想要恢复登录，势必就要绕过双因素认证，这就形成了一个安全漏洞。除非<code>准备两套双因素认证，一套用来登录，另一套用来恢复账户</code>。</p>
<h2 id="7f4576f558ebec8c9b2719a8d1642533">七、参考链接</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Multi-factor_authentication">Multi-factor authentication</a>, by Wikipedia</li>
<li><a href="https://en.wikipedia.org/wiki/Time-based_One-time_Password_Algorithm">Time-based One-time Password Algorithm</a>, by Wikipedia</li>
<li><a href="https://techblog.bozho.net/enabling-two-factor-authentication-web-application/">Enabling Two-Factor Authentication For Your Web Application</a>, by Bozhidar Bozhanov</li>
<li><a href="https://github.com/simontabor/2fa">simontabor/2fa</a>, by Simon Tabor</li>
</ul>
<p>（正文完）</p>
<h3 id="38f519304a768c940587c9a157280045">文档信息</h3>
<ul>
<li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">创意共享3.0许可证</a>）</li>
<li>发表日期： 2017年11月 2日</li>
</ul>
<p>本文转自 <a href="https://www.ruanyifeng.com/blog/2017/11/2fa-tutorial.html">https://www.ruanyifeng.com/blog/2017/11/2fa-tutorial.html</a>，如有侵权，请联系删除。</p><h4 style="text-align:left;line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont, Helvetica Neue, PingFang SC, Hiragino Sans GB , Microsoft YaHei UI , Microsoft YaHei ,Arial,sans-serif;font-size:14px;font-weight:bold;margin:2em 8px 0.5em;color:rgba(250, 81, 81, 1)">引用链接</h4><p style="text-align:left;line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont, Helvetica Neue, PingFang SC, Hiragino Sans GB , Microsoft YaHei UI , Microsoft YaHei ,Arial,sans-serif;font-size:80%;margin:0.5em 8px;color:#3f3f3f"><code style="font-size: 90%; opacity: 0.6;">[1]</code> 案例: <i><a href="http://media.people.com.cn/n/2014/0227/c40606-24477072.html" target="_blank">http://media.people.com.cn/n/2014/0227/c40606-24477072.html</a></i><br><code style="font-size: 90%; opacity: 0.6;">[2]</code> TOTP: <i><a href="https://en.wikipedia.org/wiki/Time-based_One-time_Password_Algorithm" target="_blank">https://en.wikipedia.org/wiki/Time-based_One-time_Password_Algorithm</a></i><br><code style="font-size: 90%; opacity: 0.6;">[3]</code> RFC6238: <i><a href="https://tools.ietf.org/html/rfc6238" target="_blank">https://tools.ietf.org/html/rfc6238</a></i><br><code style="font-size: 90%; opacity: 0.6;">[4]</code> `2fa`: <i><a href="https://github.com/simontabor/2fa" target="_blank">https://github.com/simontabor/2fa</a></i><br><code style="font-size: 90%; opacity: 0.6;">[5]</code> Multi-factor authentication: <i><a href="https://en.wikipedia.org/wiki/Multi-factor_authentication" target="_blank">https://en.wikipedia.org/wiki/Multi-factor_authentication</a></i><br><code style="font-size: 90%; opacity: 0.6;">[6]</code> Time-based One-time Password Algorithm: <i><a href="https://en.wikipedia.org/wiki/Time-based_One-time_Password_Algorithm" target="_blank">https://en.wikipedia.org/wiki/Time-based_One-time_Password_Algorithm</a></i><br><code style="font-size: 90%; opacity: 0.6;">[7]</code> Enabling Two-Factor Authentication For Your Web Application: <i><a href="https://techblog.bozho.net/enabling-two-factor-authentication-web-application/" target="_blank">https://techblog.bozho.net/enabling-two-factor-authentication-web-application/</a></i><br><code style="font-size: 90%; opacity: 0.6;">[8]</code> simontabor/2fa: <i><a href="https://github.com/simontabor/2fa" target="_blank">https://github.com/simontabor/2fa</a></i><br><code style="font-size: 90%; opacity: 0.6;">[9]</code> 创意共享3.0许可证: <i><a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh</a></i><br><code style="font-size: 90%; opacity: 0.6;">[10]</code> https://www.ruanyifeng.com/blog/2017/11/2fa-tutorial.html: <i><a href="https://www.ruanyifeng.com/blog/2017/11/2fa-tutorial.html" target="_blank">https://www.ruanyifeng.com/blog/2017/11/2fa-tutorial.html</a></i><br></p>
			</div>
</div>

            <larecipe-back-to-top></larecipe-back-to-top>
        </div>


        <script>
            window.config = [];
        </script>

        <script type="text/javascript">
            if(localStorage.getItem('larecipeSidebar') == null) {
                localStorage.setItem('larecipeSidebar', !! 1);
            }
        </script>

        <script src="../../vendor/binarytorch/larecipe/assets/js/app.js"></script>

        <script>
            window.LaRecipe = new CreateLarecipe(config)
        </script>

        <!-- Google Analytics -->
                <!-- /Google Analytics -->

        
        <script>
            LaRecipe.run()
        </script>
    </body>
</html>
