<!doctype html>
<html>
    <head>
        <!-- META Tags -->
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Mysql 性能优化方法汇总 | 风中的木偶</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- SEO -->
        <meta name="author" content="风中的木偶">
        <meta name="description" content="">
        <meta name="keywords" content="木偶笔记,个人技术博客,IT技术笔记,博客,个人网站,风中的木偶,木偶">
        <meta name="twitter:card" value="summary">
                                                                <meta property="og:title" content="风中的木偶个人博客" />
                                                                <meta property="og:type" content="article" />
                                                                <meta property="og:url" content="https://wangmaolin.net" />
                                                                                            
        <!-- CSS -->
        <link rel="stylesheet" href="../../vendor/binarytorch/larecipe/assets/css/app.css">

        
        <!-- FontAwesome -->
        <link rel="stylesheet" href="../../vendor/binarytorch/larecipe/assets/css/font-awesome.css">
                    <link rel="stylesheet" href="../../vendor/binarytorch/larecipe/assets/css/font-awesome-v4-shims.css">
        
        <!-- Dynamic Colors -->
        <style>
    :root {
        --primary: #787AF6;
        --secondary: #2b9cf2;
    }

    :not(pre)>code[class*=language-], pre[class*=language-] {
        border-top: 3px solid #787AF6;
    }
    
    .bg-gradient-primary {
        background: linear-gradient(87deg, #787AF6 0, #2b9cf2 100%) !important;
    }

    [v-cloak] > * { 
        display: none; 
    }
    
    [v-cloak]::before { 
        content: " ";
        position: absolute;
        width: 100%;
        height: 100%;
        background-color: #F2F6FA;
    }
</style>
        <!-- CSRF Token -->
        <meta name="csrf-token" content="476dd8VPqlno3tKrJ2sgvTLvrXXd14RRolMMi7yY">

        
    </head>
    <body>
        <div id="app" v-cloak>
            <div class="fixed pin-t pin-x z-40">
    <div class="bg-gradient-primary text-white h-1"></div>

    <nav class="flex items-center justify-between text-black bg-navbar shadow-xs h-16">
        <div class="flex items-center flex-no-shrink">
            <a href="../../index.html" class="flex items-center flex-no-shrink text-black mx-4">
                
                <p class="inline-block font-semibold mx-1 text-grey-dark">
                    风中的木偶
                </p>
            </a>

            <div class="switch">
                <input type="checkbox" name="1" id="1" v-model="sidebar" class="switch-checkbox"/>
                <label class="switch-label" for="1"></label>
            </div>
        </div>

        <div class="hidden lg:flex items-center justify-end pr-4">
            <div class="relative">
                <form action="https://wangmaolin.net/search" onsubmit="return validateForm()" class="form-search">
                    <input id="search-input" name="q" type="text" placeholder="Search" class="bg-gray-100 appearance-none border-2 border-gray-200 rounded py-2 px-4
         text-gray-800 leading-tight focus:outline-none focus:bg-white focus:border-gray-500">
                </form>
            </div>
        </div>

        <div class="block mx-4 flex items-center">
                        
            
            
            
            

            
            <larecipe-dropdown>
                <larecipe-button type="primary" class="flex">
                    MySQL <i class="mx-1 fa fa-angle-down"></i>
                </larecipe-button>

                <template slot="list">
                    <ul class="list-reset" style="height: 800px;width: 200px">
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../AI/overview.html">AI</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../APP/overview.html">APP</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../CSS/overview.html">CSS</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Docker/overview.html">Docker</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../ELK/overview.html">ELK</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Git/overview.html">Git</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Go语言/overview.html">Go语言</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Laravel/overview.html">Laravel</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Linux/overview.html">Linux</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Linux&#32;服务器配置/overview.html">Linux 服务器配置</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Mac/overview.html">Mac</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../MongoDB/overview.html">MongoDB</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Mqtt/overview.html">Mqtt</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="overview.html">MySQL</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Nginx/overview.html">Nginx</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../PHP/overview.html">PHP</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Protobuf/overview.html">Protobuf</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Python/overview.html">Python</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../SEO/overview.html">SEO</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Vue&#32;教程/overview.html">Vue 教程</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../Windows/overview.html">Windows</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../webman/overview.html">webman</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../一无所有到财富自由/overview.html">一无所有到财富自由</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../云服务/overview.html">云服务</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../产品/overview.html">产品</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../元宇宙/overview.html">元宇宙</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../前端/overview.html">前端</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../合伙的本质/overview.html">合伙的本质</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../商业/overview.html">商业</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../大数据/overview.html">大数据</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../天机38局/overview.html">天机38局</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../开源项目/overview.html">开源项目</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../微信/overview.html">微信</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../控糖革命/overview.html">控糖革命</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../搜索/overview.html">搜索</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../支付/overview.html">支付</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../智慧人生/overview.html">智慧人生</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../架构/overview.html">架构</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../游戏开发/overview.html">游戏开发</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../算法/overview.html">算法</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../缓存/overview.html">缓存</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../网络/overview.html">网络</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../自媒体/overview.html">自媒体</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../菜谱/overview.html">菜谱</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../设计模式/overview.html">设计模式</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../资源/overview.html">资源</a>
                            </li>
                                                    <li class="py-2 hover:bg-grey-lightest">
                                <a class="px-6 text-grey-darkest"
                                   href="../软件工具/overview.html">软件工具</a>
                            </li>
                                            </ul>
                </template>
            </larecipe-dropdown>
            

                    </div>
    </nav>
</div>

            
            <div>
	<div class="sidebar" :class="[{'is-hidden': ! sidebar}]">
    <ul>
<li>
<h2>字段</h2>
<ul>
<li id="blog71"><a href="x2ev8zwvor.html#blog71">MySQL 批量替换字段中的域名</a>
<li id="blog112"><a href="jwnex74vxd.html#blog112">Mysql 的日期时间类型说明</a>
<li id="blog337"><a href="mdgy70xvw2.html#blog337">MySql 字段类型说明和推荐</a>
</ul>
</li>
<li>
<h2>性能</h2>
<ul>
<li id="blog82"><a href="4x3vo76ym1.html#blog82">MySQL 回表查询</a>
<li id="blog336"><a href="x569xxr9ep.html#blog336">高并发系统数据库架构设计</a>
<li id="blog351"><a href="k3dyk7zvl0.html#blog351">MySql 定位和分析执行效率的方法</a>
<li id="blog488"><a href="od6vrqr93g.html#blog488">MySql 单表分页 Limit 性能优化</a>
<li id="blog492"><a href="4wevwlzyl2.html#blog492">MySql 索引介绍</a>
<li id="blog675"><a href="3dykq84yl0.html#blog675">Mysql 性能优化方法汇总</a>
</ul>
</li>
<li>
<h2>MySQL</h2>
<ul>
<li id="blog86"><a href="lgwyldne3q.html#blog86">MySQL concat、concat_ws、group_concat 函数用法</a>
<li id="blog107"><a href="m0wek4wyp9.html#blog107">SQL 中 WHERE 和 HAVING 子句有什么区别？</a>
<li id="blog134"><a href="54lvo36v6z.html#blog134">MySql 5.7 报错 sql_mode=only_full_group_by 问题解决方法</a>
<li id="blog148"><a href="8loyn5oyz3.html#blog148">mysql 控制 sql 长度的相关参数</a>
<li id="blog172"><a href="de296j6vq7.html#blog172">MySql 各日志配置方法：错误日志、慢查询日志、执行日志</a>
<li id="blog177"><a href="n2oegm5e73.html#blog177">MySQL 查询中 where in 如何保持顺序</a>
<li id="blog270"><a href="71xyjw0ed9.html#blog270">理解 MySQL 字符集</a>
<li id="blog300"><a href="8loyn11vz3.html#blog300">MySQL order by limit 分页数据重复或丢失问题说明</a>
<li id="blog301"><a href="nxq9zd5ydo.html#blog301">mysql 事务特性以及隔离级别说明</a>
<li id="blog302"><a href="z64y912e5l.html#blog302">MySQL 共享锁&amp;排他锁</a>
<li id="blog352"><a href="rpnv37wywm.html#blog352">MySQL 创建索引报错 &quot;Specified key was too long; max key length is 767 bytes&quot; 原因</a>
<li id="blog473"><a href="nxq9zgjydo.html#blog473">MySQL中当字段值为 <code>NULL</code> 时的注意事项</a>
<li id="blog489"><a href="02ky0klvz8.html#blog489">SQL 的执行顺序</a>
<li id="blog490"><a href="n2qvpnzy3m.html#blog490">MySQL 基础架构</a>
<li id="blog491"><a href="5m892e6901.html#blog491">MySQL不能远程连接解决方法</a>
<li id="blog829"><a href="5dve27jv4x.html#blog829">MySQL 实现条件排序 ORDER BY CASE WHEN</a>
</ul>
</li>
<li>
<h2>安全</h2>
<ul>
<li id="blog709"><a href="3xyq4qjvmq.html#blog709">SQL 注入漏洞</a>
</ul>
</li>
</ul>
</div>

<style>
    #cnzz_stat_icon_1280630928
    {
        display: none;
    }
</style>

<script src="../../vendor/binarytorch/larecipe/assets/js/jquery.min.js"></script>
<script src="../../modules/blog/js/detail.js"></script>

<script type="text/javascript">
    $(function () {
        var cid = '3dykq84yl0.html';
        if (!checkView(cid)) {
            $.get('https://wangmaolin.net/api/blog/addView/article/3dykq84yl0.html', function (data, status) {
                addView('3dykq84yl0.html')
            });
        }
    });
</script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?7c12b9716af39eb368cff4a19aa89393";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7125202304422722"
     crossorigin="anonymous"></script>
	
	<div class="documentation is-dark" :class="{'expanded': ! sidebar}">
		<h1>Mysql 性能优化方法汇总</h1><ul>
<li><a href="3dykq84yl0.html#547287aa3bd4023959d54963f3acb0bf">1、添加索引</a></li>
<li><a href="3dykq84yl0.html#2347fc67af810eba0dc0cc205f7a3446">2、合适的数据类型</a></li>
<li><a href="3dykq84yl0.html#5b15a397a887da26428b3f62955a0d75">3、当只要一行数据时使用 LIMIT 1</a></li>
<li><a href="3dykq84yl0.html#574f912dca3d6fa41adb7cffc7134561">4、避免查询无关的行</a></li>
<li><a href="3dykq84yl0.html#e83027d4d02f4a01d86d526284e84177">5、count操作注意</a></li>
<li><a href="3dykq84yl0.html#3a5162cff47d7d6c05e889090796639b">6、group by</a></li>
<li><a href="3dykq84yl0.html#05bad41fe7964462072d2467b55b3dd0">7、Limit分页优化</a></li>
<li><a href="3dykq84yl0.html#42d6c3142737640f3bf9fa3a15b08321">8、INNER JOIN 而不是 WHERE</a></li>
<li><a href="3dykq84yl0.html#21361d51430a60378b3045fd4872f690">9、一条SQL语句插入多条数据</a></li>
<li><a href="3dykq84yl0.html#30ba80d47919f274923e1091251dcaba">10、数据有序插入</a></li>
<li><a href="3dykq84yl0.html#1f92da7c010e27c1eda77a7d98d0cba0">11、count() 替换</a></li>
<li><a href="3dykq84yl0.html#10aa05eddeb6c7c0771b616e791515ca">12、关联查询优化：</a></li>
<li><a href="3dykq84yl0.html#07e1c52d139cd540e6fc016dd09fac0b">13、union 优化：</a></li>
<li><a href="3dykq84yl0.html#8dd52e2a330cc66094e3d4867fd49876">14、大表 alter  table：</a></li>
<li><a href="3dykq84yl0.html#35d9d7a2fc587eb5d92c14610709655c">15、千万不要 ORDER BY RAND()</a></li>
<li><a href="3dykq84yl0.html#6660ed0f94c9fc507b38f7b2dff3d4f5">16、避免 SELECT *</a></li>
<li><a href="3dykq84yl0.html#609624b35f572197a7131e0dea50a441">17、永远为每张表设置一个ID</a></li>
<li><a href="3dykq84yl0.html#dab29f34fe003bb620120706b4d5c2d8">18、尽可能的使用 NOT NULL</a></li>
<li><a href="3dykq84yl0.html#805ce69788b9339c31cc461d8ce61e59">19、选择正确的存储引擎</a></li>
<li><a href="3dykq84yl0.html#e903a020c0b2772fbd14d4b56cba1f92">20、对表进行水平划分</a></li>
<li><a href="3dykq84yl0.html#0470b103b0c436eff4a88b8b7913fa02">21、对表进行垂直划分</a></li>
<li><a href="3dykq84yl0.html#f71460f4bdf5f350f5e5a87555516ea5">22、设置主从同步，读写分离</a></li>
<li><a href="3dykq84yl0.html#dea77b4aaf4516642d8d77cfe07aeef3">23、水平分库分表</a></li>
<li><a href="3dykq84yl0.html#4b5f279935b7036c8be27d4c0c616c9c">24、垂直分库</a></li>
<li><a href="3dykq84yl0.html#1260781863b22bb5c2797c73378c61e2">25、表命名问题</a></li>
</ul><h3 id="547287aa3bd4023959d54963f3acb0bf">1、添加索引</h3>
<h3 id="2347fc67af810eba0dc0cc205f7a3446">2、合适的数据类型</h3>
<p>尽可能小、尽可能定长、尽可能使用整数；</p>
<p>尽量使用对应的数据类型。比如，不要用字符串类型保存时间，用整型保存IP。</p>
<p>选择更小的数据类型。能用TinyInt不用Int。</p>
<h3 id="5b15a397a887da26428b3f62955a0d75">3、当只要一行数据时使用 LIMIT 1</h3>
<p>当你查询表的有些时候，你已经知道结果只会有一条结果，但因为你可能需要去fetch游标，或是你也许会去检查返回的记录数。</p>
<p>在这种情况下，加上 LIMIT 1 可以增加性能。这样一样，MySQL数据库引擎会在找到一条数据后停止搜索，而不是继续往后查少下一条符合记录的数据。</p>
<h3 id="574f912dca3d6fa41adb7cffc7134561">4、避免查询无关的行</h3>
<h3 id="e83027d4d02f4a01d86d526284e84177">5、count操作注意</h3>
<p>count只能统计不为null的列，所以统计总的行数使用count（*）。</p>
<h3 id="3a5162cff47d7d6c05e889090796639b">6、group by</h3>
<p>按照标识列分组效率高，分组结果不宜出现分组列之外的列。</p>
<h3 id="05bad41fe7964462072d2467b55b3dd0">7、Limit分页优化</h3>
<p><a href="https://fengzhongmuou.feishu.cn/wiki/U8dnwJ2yVilIP8knZh2ceSbmnMd">利用表的覆盖索引来加速分页查询。</a></p>
<h3 id="42d6c3142737640f3bf9fa3a15b08321">8、INNER JOIN 而不是 WHERE</h3>
<p>使用INNER JOIN 而不是WHERE来创建连接(多表查询)</p>
<p>一些SQL开发人员更喜欢使用WHERE来做join，比如：​</p>
<pre><code class="language-sql">SELECT Customers.CustomerID, Customers.Name, Sales.LastSaleDate FROM Customers, Sales WHERE Customers.CustomerID = Sales.CustomerID</code></pre>
<p>这个类型where实际上创建时笛卡尔连接。 在笛卡尔连接中，所有可能的组合都会被创建出来。在上面的例子中，如果有1000顾客和1000条销售记录，这个查询会先产生1000000个结果，然后通过正确的 CustomerID过滤出1000条记录。 这是一种低效利用数据库资源，数据库多做100倍的工作。 在大型数据库中，笛卡尔连接是一个大问题，对两个大表的笛卡尔积会创建数10亿或万亿的记录。</p>
<p>为了避免创建笛卡尔积，应该使用INNER JOIN ：​</p>
<pre><code class="language-sql">SELECT Customers.CustomerID, Customers.Name, Sales.LastSaleDate FROM Customers INNER JOIN Sales ON Customers.CustomerID = Sales.CustomerID</code></pre>
<p>这样数据库就只产生等于CustomerID 的1000条目标结果。</p>
<p>有些数据库系统会识别出 WHERE连接并自动转换为 INNER JOIN。在这些数据库系统中，WHERE 连接与INNER JOIN 就没有性能差异。但是， INNER JOIN 是所有数据库都能识别的，因此DBA会建议在你的环境中使用它。</p>
<h3 id="21361d51430a60378b3045fd4872f690">9、一条SQL语句插入多条数据</h3>
<p>如：</p>
<pre><code class="language-sql">INSERT INTO insert_table (datetime, uid, content, type) 
VALUES ('0', 'userid_0', 'content_0', 0), ('1', 'userid_1', 'content_1', 1);</code></pre>
<p>合并后日志量（MySQL的binlog和innodb的事务日志）减少了，降低日志刷盘的数据量和频率，从而提高效率，同时也能减少SQL语句解析的次数，减少网络传输的IO。</p>
<p>当然合并条数不要太多，要适量，防止阻塞数据库。同时SQL语句是有长度限制，在进行数据合并在同一SQL中务必不能超过SQL长度限制，通过max_allowed_packet配置可以修改，默认是1M，测试时修改为8M。</p>
<h3 id="30ba80d47919f274923e1091251dcaba">10、数据有序插入</h3>
<p>数据有序的插入是指插入记录在主键上是有序排列，dateid：</p>
<pre><code class="language-sql">INSERT INTO insert_table (dateid, uid, content, type) VALUES ('0', 'userid_0', 'content_0', 0);
INSERT INTO insert_table (dateid, uid, content, type) VALUES ('1', 'userid_1', 'content_1', 1);
INSERT INTO insert_table (dateid, uid, content, type) VALUES ('2', 'userid_2', 'content_2',2);</code></pre>
<p>由于数据库插入时，需要维护索引数据，无序的记录会增大维护索引的成本。我们可以参照 innodb 使用的 B+tree 索引，如果每次插入记录都在索引的最后面，索引的定位效率很高，并且对索引调整较小；如果插入的记录在索引中间，需要 B+tree 进行分裂合并等处理，会消耗比较多计算资源，并且插入记录的索引定位效率会下降，数据量较大时会有频繁的磁盘操作。  建表时最好以自增id为主键就解决了这个问题。</p>
<h3 id="1f92da7c010e27c1eda77a7d98d0cba0">11、count() 替换</h3>
<p>有时候某些业务场景并不需要完全精确的COUNT值，可以用近似值来代替，EXPLAIN 出来的行数就是一个不错的近似值，而且执行EXPLAIN并不需要真正地去执行查询，所以成本非常低。</p>
<p>实例：</p>
<pre><code class="language-sql">[SQL]select count(name) from aaa;
受影响的行: 0
时间: 2.957s

结果：
428396

[SQL]EXPLAIN select count(name) from aaa;
受影响的行: 0
时间: 0.038s

结果：
1  SIMPLE  aaa  index  name_idx  767  413996  Using index</code></pre>
<p>通常来说，执行 COUNT() 都需要扫描大量的行才能获取到精确的数据，因此很难优化，MySQL层面还能做得也就只有覆盖索引了。</p>
<p>其他解决方法，只有从架构层面解决了，比如添加汇总表，或者使用 redis 这样的外部缓存系统。</p>
<h3 id="10aa05eddeb6c7c0771b616e791515ca">12、关联查询优化：</h3>
<hr />
<p>在大数据场景下，表与表之间通过一个冗余字段来关联，要比直接使用JOIN有更好的性能。如果确实需要使用关联查询的情况下，需要特别注意的是：</p>
<p>1、确保ON和USING字句中的列上有索引。在创建索引的时候就要考虑到关联的顺序。当表A和表B用列c关联的时候，如果优化器关联的顺序是A、B，那么就不需要在A表的对应列上创建索引。</p>
<p>2、没有用到的索引会带来额外的负担，一般来说，除非有其他理由，只需要在关联顺序中的第二张表的相应列上创建索引。</p>
<p>3、确保任何的GROUP BY和ORDER BY中的表达式只涉及到一个表中的列，这样MySQL才有可能使用索引来优化。</p>
<h3 id="07e1c52d139cd540e6fc016dd09fac0b">13、union 优化：</h3>
<p>MySQL处理UNION的策略是先创建临时表，然后再把各个查询结果插入到临时表中，最后再来做查询。因此很多优化策略在UNION查询中都没有办法很好的时候。经常需要手动将WHERE、LIMIT、ORDER BY等字句“下推”到各个子查询中，以便优化器可以充分利用这些条件先优化。</p>
<p>除非确实需要服务器去重，否则就一定要使用UNION ALL，如果没有ALL关键字，MySQL会给临时表加上DISTINCT选项，这会导致整个临时表的数据做唯一性检查，这样做的代价非常高。当然即使使用ALL关键字，MySQL总是将结果放入临时表，然后再读出，再返回给客户端。虽然很多时候没有这个必要，比如有时候可以直接把每个子查询的结果返回给客户端。</p>
<h3 id="8dd52e2a330cc66094e3d4867fd49876">14、大表 alter  table：</h3>
<p>大表ALTER TABLE非常耗时，MySQL执行大部分修改表结果操作的方法是用新的结构创建一个张空表，从旧表中查出所有的数据插入新表，然后再删除旧表。</p>
<p>尤其当内存不足而表又很大，而且还有很大索引的情况下，耗时更久。当然有一些奇淫技巧可以解决这个问题，有兴趣可自行查阅。</p>
<p>比如：大表更改默认值使用alter table不重建表，直接修改.frm</p>
<p>在MySQL中执行很大部分的修改动作，都需要重建一个表，然后把数据放进去，最后删除旧的表！有时候要是有索引的列上进行大批且频繁的表的时候会导致系统的性能严重下降，这里可以在修改SQL上做部分调整，减轻相关的构建结构带来的系统压力问题！</p>
<p>例如 在修改一个表的默认值为8的时候，常规做法为：</p>
<pre><code class="language-sql">alter table  modes modify column  dept tinyint(3) not null default 8；</code></pre>
<p>这里通过一些show status分析出，每次都要做大量的句柄的读取和插入操作，类似于从新构建了一张新表的样式，这样在一些大表，上千万的数据量会出现瓶颈问题！</p>
<p>这里我们需要灵活知道mysql的相关默认值实际是放在相关的表结构.frm文件中；我们可以不经过数据层，可以直接调整！上述的modify column会导致相关的表进行拷贝操作，不利于系统的正常稳定运行，可以使用下面方式；</p>
<pre><code class="language-sql">alter table modes alter column dept set default 8;</code></pre>
<p>这里只是更改了相关的frm文件，没有改动表，因此速度很快的即可完成；</p>
<p>总结：在此我们可以注意到相关的alter table后面跟不同形式的命令，可以对数据产生了不同程度的影响，这里还有一个change column操作也是不一样的！</p>
<h3 id="35d9d7a2fc587eb5d92c14610709655c">15、千万不要 ORDER BY RAND()</h3>
<p>想打乱返回的数据行？随机挑一个数据？真不知道谁发明了这种用法，但很多新手很喜欢这样用。但你确不了解这样做有多么可怕的性能问题。</p>
<p>如果你真的想把返回的数据行打乱了，你有N种方法可以达到这个目的。这样使用只让你的数据库的性能呈指数级的下降。这里的问题是：MySQL会不得 不去执行RAND()函数（很耗CPU时间），而且这是为了每一行记录去记行，然后再对其排序。就算是你用了Limit 1也无济于事（因为要排序）</p>
<h3 id="6660ed0f94c9fc507b38f7b2dff3d4f5">16、避免 SELECT *</h3>
<p>从数据库里读出越多的数据，那么查询就会变得越慢。并且，如果你的数据库服务器和WEB服务器是两台独立的服务器的话，这还会增加网络传输的负载。使用具体字段，在索引覆盖的情况下还可以避免回表。</p>
<p>所以，你应该养成一个需要什么就取什么的好的习惯。</p>
<pre><code class="language-php">// 不推荐
$r = mysql_query("SELECT * FROM user WHERE user_id = 1");
$$d = mysql_fetch_assoc($$r);
echo "Welcome {$d['username']}";

// 推荐
$r = mysql_query("SELECT username FROM user WHERE user_id = 1");
$$d = mysql_fetch_assoc($$r);
echo "Welcome {$d['username']}";</code></pre>
<h3 id="609624b35f572197a7131e0dea50a441">17、永远为每张表设置一个ID</h3>
<p>我们应该为数据库里的每张表都设置一个ID做为其主键，而且最好的是一个INT型的（推荐使用UNSIGNED），并设置上自动增加的AUTO_INCREMENT标志。</p>
<p>就算是你 users 表有一个主键叫 “email”的字段，你也别让它成为主键。使用 VARCHAR 类型来当主键会使用得性能下降。另外，在你的程序中，你应该使用表的ID来构造你的数据结构。</p>
<p>而且，在MySQL数据引擎下，还有一些操作需要使用主键，在这些情况下，主键的性能和设置变得非常重要，比如，集群，分区……</p>
<p>在这里，只有一个情况是例外，那就是“关联表”的“外键”，也就是说，这个表的主键，通过若干个别的表的主键构成。我们把这个情况叫做“外键”。比 如：有一个“学生表”有学生的ID，有一个“课程表”有课程ID，那么，“成绩表”就是“关联表”了，其关联了学生表和课程表，在成绩表中，学生ID和课 程ID叫“外键”其共同组成主键。</p>
<h3 id="dab29f34fe003bb620120706b4d5c2d8">18、尽可能的使用 NOT NULL</h3>
<p>除非你有一个很特别的原因去使用 NULL 值，你应该总是让你的字段保持 NOT NULL。这看起来好像有点争议，请往下看。</p>
<p>首先，问问你自己“Empty”和“NULL”有多大的区别（如果是INT，那就是0和NULL）？如果你觉得它们之间没有什么区别，那么你就不要使用NULL。（你知道吗？在 Oracle 里，NULL 和 Empty 的字符串是一样的！)</p>
<p>不要以为 NULL 不需要空间，其需要额外的空间，并且，在你进行比较的时候，你的程序会更复杂。 当然，这里并不是说你就不能使用NULL了，现实情况是很复杂的，依然会有些情况下，你需要使用NULL值。</p>
<p>下面摘自MySQL自己的文档：</p>
<p>“<code>NULL columns require additional space in the row to record whether their values are NULL. For MyISAM tables, each NULL column takes one bit extra, rounded up to the nearest byte.”</code></p>
<h3 id="805ce69788b9339c31cc461d8ce61e59">19、选择正确的存储引擎</h3>
<p>在 MySQL 中有两个存储引擎 MyISAM 和 InnoDB，每个引擎都有利有弊。</p>
<p>MyISAM 适合于一些需要大量查询的应用，但其对于有大量写操作并不是很好。甚至你只是需要update一个字段，整个表都会被锁起来，而别的进程，就算是读进程都无法操作直到读操作完成。另外，MyISAM 对于 SELECT COUNT(*) 这类的计算是超快无比的。</p>
<p>InnoDB 的趋势会是一个非常复杂的存储引擎，对于一些小的应用，它会比 MyISAM 还慢。他是它支持“行锁” ，于是在写操作比较多的时候，会更优秀。并且，他还支持更多的高级应用，比如：事务。</p>
<p>老版本中mysql默认搜索引擎是MyISAM， 现在已经都改为innodb。</p>
<h3 id="e903a020c0b2772fbd14d4b56cba1f92">20、对表进行水平划分</h3>
<p>如果一个表的记录数太多了，比如上千万条，而且需要经常检索，那么我们就有必要化整为零了。如果我拆成100个表，那么每个表只有10万条记录。当然这 需要数据在逻辑上可以划分。一个好的划分依据，有利于程序的简单实现，也可以充分利用水平分表的优势。比如系统界面上只提供按月查询的功能，那么把表按月 拆分成12个，每个查询只查询一个表就够了。如果非要按照地域来分，即使把表拆的再小，查询还是要联合所有表来查，还不如不拆了。所以一个好的拆分依据是 最重要的。</p>
<p>水平分表，能够降低单表的数据量，一定程度上可以缓解查询性能瓶颈。但本质上这些表还保存在同一个库中，所以库级别还是会有IO瓶颈。所以，一般不建议采用这种做法。</p>
<h3 id="0470b103b0c436eff4a88b8b7913fa02">21、对表进行垂直划分</h3>
<p>有些表记录数并不多，可能也就2、3万条，但是字段却很长，表占用空间很大，检索表时需要执行大量I/O，严重降低了性能。这个时候需要把大的字段拆分到另一个表，并且该表与原表是一对一的关系。（降低了每张表的文件大小）</p>
<p>实例：文章信息表就可以拆分成两张表，一张记录文章信息如作者、栏目、发表日期、关键词等，另一张表记录 文章内容，摘要等。利用id进行对应。因为在大多数情况下只需要搜索第一张表即可，只有在文章展示页才需要访问两张表，如此可以提高搜索性能!</p>
<h3 id="f71460f4bdf5f350f5e5a87555516ea5">22、设置主从同步，读写分离</h3>
<p>MySQL主从同步的作用：</p>
<blockquote>
<p>1、可以作为一种备份机制，相当于热备份（在从备份，避免备份期间影响主服务器服务）</p>
<p>2、可以用来做读写分离，均衡数据库负载(主写从读)</p>
<p>3、当主服务器出现问题时，可以切换到从服务器。</p>
</blockquote>
<h3 id="dea77b4aaf4516642d8d77cfe07aeef3">23、水平分库分表</h3>
<p>水平分库分表与上面讲到的水平分表的思想相同，唯一不同的就是将这些拆分出来的表保存在不同的数据库中。这也是很多大型互联网公司所选择的做法。</p>
<p>某种意义上来讲，有些系统中使用的“冷热数据分离”（将一些使用较少的历史数据迁移到其他的数据库中。而在业务功能上，通常默认只提供热点数据的查询），也是类似的实践。在高并发和海量数据的场景下，分库分表能够有效缓解单机和单库的性能瓶颈和压力，突破IO、连接数、硬件资源的瓶颈。当然，投入的硬件成本也会更高。同时，这也会带来一些复杂的技术问题和挑战（例如：跨分片的复杂查询，跨分片事务等）</p>
<h3 id="4b5f279935b7036c8be27d4c0c616c9c">24、垂直分库</h3>
<p>垂直分库在“微服务”盛行的今天已经非常普及了。基本的思路就是按照业务模块来划分出不同的数据库，而不是像早期一样将所有的数据表都放到同一个数据库中。</p>
<h3 id="1260781863b22bb5c2797c73378c61e2">25、表命名问题</h3>
<p>数据库表名创建时使用小写英文字母加下划线的形式，不要出现大写字母，防止大小写敏感问题（数据库、字段创建最好也遵守这一规则，保持统一）</p><h4 style="text-align:left;line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont, Helvetica Neue, PingFang SC, Hiragino Sans GB , Microsoft YaHei UI , Microsoft YaHei ,Arial,sans-serif;font-size:14px;font-weight:bold;margin:2em 8px 0.5em;color:rgba(250, 81, 81, 1)">引用链接</h4><p style="text-align:left;line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont, Helvetica Neue, PingFang SC, Hiragino Sans GB , Microsoft YaHei UI , Microsoft YaHei ,Arial,sans-serif;font-size:80%;margin:0.5em 8px;color:#3f3f3f"><code style="font-size: 90%; opacity: 0.6;">[1]</code> 利用表的覆盖索引来加速分页查询。: <i><a href="https://fengzhongmuou.feishu.cn/wiki/U8dnwJ2yVilIP8knZh2ceSbmnMd" target="_blank">https://fengzhongmuou.feishu.cn/wiki/U8dnwJ2yVilIP8knZh2ceSbmnMd</a></i><br></p>
			</div>
</div>

            <larecipe-back-to-top></larecipe-back-to-top>
        </div>


        <script>
            window.config = [];
        </script>

        <script type="text/javascript">
            if(localStorage.getItem('larecipeSidebar') == null) {
                localStorage.setItem('larecipeSidebar', !! 1);
            }
        </script>

        <script src="../../vendor/binarytorch/larecipe/assets/js/app.js"></script>

        <script>
            window.LaRecipe = new CreateLarecipe(config)
        </script>

        <!-- Google Analytics -->
                <!-- /Google Analytics -->

        
        <script>
            LaRecipe.run()
        </script>
    </body>
</html>
